{"version":3,"sources":["D2App/actions/Actions.module.css","D2App/clearForm/ClearForm.module.css","D2App/clearForm/FormSection.module.css","D2App/views/Home.module.css","D2App/locales/index.js","D2App/actions/Actions.js","D2App/clearForm/FormSection.js","D2App/clearForm/ClearForm.js","D2App/indexedDb/dbExists.js","D2App/indexedDb/deleteDb.js","D2App/indexedDb/dhis2DatabaseNames.js","D2App/indexedDb/getCaptureAppUserDatabases.js","D2App/indexedDb/openDb.js","D2App/indexedDb/getKeyFromObjectStore.js","D2App/indexedDb/useClearableDatabaseKeys.js","D2App/indexedDb/getClearableDatabases.js","D2App/storage/clearStoragesByKey.js","D2App/storage/reservedStorageKeys.js","D2App/storage/useClearableStorageKeys.js","D2App/storage/getClearableKeys.js","D2App/views/Home/deleteValues.js","D2App/indexedDb/clearDatabasesByKey.js","D2App/views/Home.js","D2App/views/Home/formatDeleteValues.js","D2App/App.js"],"names":["module","exports","namespace","i18n","addResources","arTranslations","ckbTranslations","csTranslations","daTranslations","enTranslations","esTranslations","frTranslations","idTranslations","kmTranslations","loTranslations","myTranslations","nbTranslations","prsTranslations","psTranslations","ptTranslations","pt_BRTranslations","ruTranslations","svTranslations","tetTranslations","tgTranslations","ukTranslations","urTranslations","uzTranslations","uz_LatnTranslations","viTranslations","zhTranslations","zh_CNTranslations","Actions","children","React","createElement","className","styles","actions","ButtonStrip","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","formatKeyToOption","label","value","FormSection","deselectButtonLabel","emptyMessage","form","headline","selectButtonLabel","storageKeys","storageName","storageDataTestName","toLowerCase","container","groupHeadline","Button","onClick","change","dataTest","FieldGroup","map","option","Checkbox","Form","ReactFinalForm","validate","values","errors","localStorageKeys","sessionStorageKeys","indexedDatabaseKeys","FORM_ERROR","t","ClearForm","onSubmit","initialValues","handleSubmit","submitFailed","batch","selectAll","deselectAll","disabled","destructive","type","formErrors","Help","error","defaultProps","dbExists","name","Promise","resolve","reject","alreadyExists","request","window","indexedDB","open","onsuccess","result","close","deleteDb","then","onerror","onupgradeneeded","succeedWhenNonExistant","exists","deleteDatabase","dhis2DatabaseNames","getCaptureAppUserDatabases","async","db","dbNames","captureDbExists","data","storeName","transaction","objectStore","get","event","e","getKeyFromObjectStore","useClearableDatabaseKeys","refetchCounter","setRefetchCounter","useState","loading","setLoading","setData","staticDatabases","userDatabases","useEffect","all","keys","filter","catch","operation","refetch","clearStoragesByKey","storage","forEach","removeItem","reduce","success","getItem","reservedStorageKeys","Storage","useClearableStorageKeys","existingKeys","setExistingKeys","onStorageChange","useCallback","existing","includes","getClearableKeys","deleteValues","_values$indexedDB","localStorage","sessionStorage","clearSessionStorageByKeys","allDeleteProcesses","clearDatabasesByKey","Home","refetchLocalStorageKeys","refetchSessionStorageKeys","refetchIndexedDatabaseKeys","showContent","message","Fragment","formattedValues","shouldDeleteUserDatabases","formatDeleteValues","App","CssVariables","colors","spacers"],"mappings":"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","file":"static/js/app.aef9c224.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"actions\":\"Actions_actions__1BcAq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"actions\":\"ClearForm_actions__2P0VA\",\"action\":\"ClearForm_action__243lJ\",\"groupHeadline\":\"ClearForm_groupHeadline__2C-rb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"FormSection_container__20Fh9\",\"groupHeadline\":\"FormSection_groupHeadline__3kOHC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Home_container__2aYrM\",\"headline\":\"Home_headline__2WsGZ\"};","//------------------------------------------------------------------------------\n// <auto-generated>\n// This code was generated by d2-i18n-generate.\n//\n// Changes to this file may cause incorrect behavior and will be lost if\n// the code is regenerated.\n// </auto-generated>\n//------------------------------------------------------------------------------\nimport i18n from '@dhis2/d2-i18n';\nimport arTranslations from './ar/translations.json';\nimport ckbTranslations from './ckb/translations.json';\nimport csTranslations from './cs/translations.json';\nimport daTranslations from './da/translations.json';\nimport enTranslations from './en/translations.json';\nimport esTranslations from './es/translations.json';\nimport frTranslations from './fr/translations.json';\nimport idTranslations from './id/translations.json';\nimport kmTranslations from './km/translations.json';\nimport loTranslations from './lo/translations.json';\nimport myTranslations from './my/translations.json';\nimport nbTranslations from './nb/translations.json';\nimport prsTranslations from './prs/translations.json';\nimport psTranslations from './ps/translations.json';\nimport ptTranslations from './pt/translations.json';\nimport pt_BRTranslations from './pt_BR/translations.json';\nimport ruTranslations from './ru/translations.json';\nimport svTranslations from './sv/translations.json';\nimport tetTranslations from './tet/translations.json';\nimport tgTranslations from './tg/translations.json';\nimport ukTranslations from './uk/translations.json';\nimport urTranslations from './ur/translations.json';\nimport uzTranslations from './uz/translations.json';\nimport uz_LatnTranslations from './uz_Latn/translations.json';\nimport viTranslations from './vi/translations.json';\nimport zhTranslations from './zh/translations.json';\nimport zh_CNTranslations from './zh_CN/translations.json';\nconst namespace = 'default';\ni18n.addResources('ar', namespace, arTranslations);\ni18n.addResources('ckb', namespace, ckbTranslations);\ni18n.addResources('cs', namespace, csTranslations);\ni18n.addResources('da', namespace, daTranslations);\ni18n.addResources('en', namespace, enTranslations);\ni18n.addResources('es', namespace, esTranslations);\ni18n.addResources('fr', namespace, frTranslations);\ni18n.addResources('id', namespace, idTranslations);\ni18n.addResources('km', namespace, kmTranslations);\ni18n.addResources('lo', namespace, loTranslations);\ni18n.addResources('my', namespace, myTranslations);\ni18n.addResources('nb', namespace, nbTranslations);\ni18n.addResources('prs', namespace, prsTranslations);\ni18n.addResources('ps', namespace, psTranslations);\ni18n.addResources('pt', namespace, ptTranslations);\ni18n.addResources('pt_BR', namespace, pt_BRTranslations);\ni18n.addResources('ru', namespace, ruTranslations);\ni18n.addResources('sv', namespace, svTranslations);\ni18n.addResources('tet', namespace, tetTranslations);\ni18n.addResources('tg', namespace, tgTranslations);\ni18n.addResources('uk', namespace, ukTranslations);\ni18n.addResources('ur', namespace, urTranslations);\ni18n.addResources('uz', namespace, uzTranslations);\ni18n.addResources('uz_Latn', namespace, uz_LatnTranslations);\ni18n.addResources('vi', namespace, viTranslations);\ni18n.addResources('zh', namespace, zhTranslations);\ni18n.addResources('zh_CN', namespace, zh_CNTranslations);\nexport default i18n;","import propTypes from '@dhis2/prop-types';\nimport { ButtonStrip } from '@dhis2/ui';\nimport React from 'react';\nimport styles from './Actions.module.css';\nexport const Actions = ({\n  children\n}) => /*#__PURE__*/React.createElement(\"div\", {\n  className: styles.actions\n}, /*#__PURE__*/React.createElement(ButtonStrip, null, children));\nActions.propTypes = {\n  children: propTypes.node\n};","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport propTypes from '@dhis2/prop-types';\nimport { Button, FieldGroup, Checkbox } from '@dhis2/ui';\nimport React from 'react';\nimport { Actions } from '../actions/Actions';\nimport styles from './FormSection.module.css';\n\nconst formatKeyToOption = key => ({\n  label: key,\n  value: key\n});\n\nexport const FormSection = ({\n  deselectButtonLabel,\n  emptyMessage,\n  form,\n  headline,\n  selectButtonLabel,\n  storageKeys,\n  storageName\n}) => {\n  const storageDataTestName = storageName.toLowerCase();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container,\n    \"data-test\": `dhis2-cachecleaner-${storageDataTestName}`\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: styles.groupHeadline\n  }, headline), !storageKeys.length && /*#__PURE__*/React.createElement(\"p\", {\n    \"data-test\": \"dhis2-cachecleaner-emptystoragemessage\"\n  }, emptyMessage), !!storageKeys.length && /*#__PURE__*/React.createElement(Actions, null, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => form.change(storageName, storageKeys),\n    dataTest: `dhis2-cachecleaner-formsection-selectall`\n  }, selectButtonLabel), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => form.change(storageName, []),\n    dataTest: `dhis2-cachecleaner-formsection-deselectall`\n  }, deselectButtonLabel)), /*#__PURE__*/React.createElement(FieldGroup, null, storageKeys.map(formatKeyToOption).map(option => /*#__PURE__*/React.createElement(Checkbox, _extends({\n    key: option.value\n  }, option)))));\n};\nFormSection.propTypes = {\n  deselectButtonLabel: propTypes.string.isRequired,\n  emptyMessage: propTypes.string.isRequired,\n  form: propTypes.shape({\n    change: propTypes.func.isRequired\n  }).isRequired,\n  headline: propTypes.string.isRequired,\n  selectButtonLabel: propTypes.string.isRequired,\n  storageKeys: propTypes.arrayOf(propTypes.string).isRequired,\n  storageName: propTypes.string.isRequired\n};","import i18n from '@dhis2/d2-i18n';\nimport propTypes from '@dhis2/prop-types';\nimport { Button, Help, ReactFinalForm } from '@dhis2/ui';\nimport { FORM_ERROR } from 'final-form';\nimport React from 'react';\nimport { Actions } from '../actions/Actions';\nimport styles from './ClearForm.module.css';\nimport { FormSection } from './FormSection';\nconst {\n  Form\n} = ReactFinalForm;\n\nconst validate = values => {\n  const errors = {};\n\n  if (!values.localStorageKeys.length && !values.sessionStorageKeys.length && !values.indexedDatabaseKeys.length) {\n    errors[FORM_ERROR] = i18n.t('No data selected');\n  }\n\n  return errors;\n};\n\nexport const ClearForm = ({\n  onSubmit,\n  initialValues,\n  localStorageKeys,\n  sessionStorageKeys,\n  indexedDatabaseKeys\n}) => {\n  const selectAll = form => {\n    form.batch(() => {\n      form.change('localStorageKeys', localStorageKeys);\n      form.change('sessionStorageKeys', sessionStorageKeys);\n      form.change('indexedDatabaseKeys', indexedDatabaseKeys);\n    });\n  };\n\n  const deselectAll = form => {\n    form.batch(() => {\n      form.change('localStorageKeys', []);\n      form.change('sessionStorageKeys', []);\n      form.change('indexedDatabaseKeys', []);\n    });\n  };\n\n  const onFormSubmit = values => {\n    onSubmit(values);\n  };\n\n  return /*#__PURE__*/React.createElement(Form, {\n    onSubmit: onFormSubmit,\n    initialValues: initialValues,\n    validate: validate\n  }, ({\n    handleSubmit,\n    errors,\n    submitFailed,\n    form\n  }) => /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/React.createElement(Actions, null, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => selectAll(form),\n    dataTest: \"dhis2-cachecleaner-selectall\"\n  }, i18n.t('Select all')), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => deselectAll(form),\n    dataTest: \"dhis2-cachecleaner-deselectall\"\n  }, i18n.t('Deselect all')), /*#__PURE__*/React.createElement(Button, {\n    disabled: !!errors[FORM_ERROR],\n    destructive: true,\n    type: \"submit\",\n    dataTest: \"dhis2-cachecleaner-clear-top\"\n  }, i18n.t('Clear all selected items'))), /*#__PURE__*/React.createElement(FormSection, {\n    form: form,\n    emptyMessage: i18n.t('Local storage empty'),\n    selectButtonLabel: i18n.t('Select all local storage items'),\n    deselectButtonLabel: i18n.t('Deselect all local storage items'),\n    headline: i18n.t('Local storage'),\n    storageKeys: localStorageKeys,\n    storageName: \"localStorageKeys\"\n  }), /*#__PURE__*/React.createElement(FormSection, {\n    form: form,\n    emptyMessage: i18n.t('Session storage empty'),\n    selectButtonLabel: i18n.t('Select all session storage items'),\n    deselectButtonLabel: i18n.t('Deselect all session storage items'),\n    headline: i18n.t('Session storage'),\n    storageKeys: sessionStorageKeys,\n    storageName: \"sessionStorageKeys\"\n  }), /*#__PURE__*/React.createElement(FormSection, {\n    form: form,\n    emptyMessage: i18n.t('No indexed databases'),\n    selectButtonLabel: i18n.t('Select all databases'),\n    deselectButtonLabel: i18n.t('Deselect all databases'),\n    headline: i18n.t('Indexed database'),\n    storageKeys: indexedDatabaseKeys,\n    storageName: \"indexedDatabaseKeys\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.formErrors\n  }, errors[FORM_ERROR] && submitFailed && /*#__PURE__*/React.createElement(Help, {\n    error: true\n  }, errors[FORM_ERROR])), /*#__PURE__*/React.createElement(Actions, null, /*#__PURE__*/React.createElement(Button, {\n    disabled: !!errors[FORM_ERROR],\n    destructive: true,\n    type: \"submit\",\n    dataTest: \"dhis2-cachecleaner-clear-bottom\"\n  }, i18n.t('Clear all selected items')))));\n};\nClearForm.defaultProps = {\n  initialValues: {\n    localStorageKeys: [],\n    sessionStorageKeys: [],\n    indexedDatabaseKeys: []\n  }\n};\nClearForm.propTypes = {\n  indexedDatabaseKeys: propTypes.arrayOf(propTypes.string).isRequired,\n  localStorageKeys: propTypes.arrayOf(propTypes.string).isRequired,\n  sessionStorageKeys: propTypes.arrayOf(propTypes.string).isRequired,\n  onSubmit: propTypes.func.isRequired,\n  initialValues: propTypes.shape({\n    indexedDatabaseKeys: propTypes.arrayOf(propTypes.string),\n    localStorageKeys: propTypes.arrayOf(propTypes.string),\n    sessionStorageKeys: propTypes.arrayOf(propTypes.string)\n  })\n};","import { deleteDb } from './deleteDb';\n/**\n * @param {string} name\n * @returns {Promise.<bool>}\n */\n\nexport const dbExists = name => new Promise((resolve, reject) => {\n  let alreadyExists = true;\n  const request = window.indexedDB.open(name);\n\n  request.onsuccess = () => {\n    request.result.close();\n\n    if (!alreadyExists) {\n      deleteDb(name).then(() => resolve(false));\n    } else {\n      resolve(true);\n    }\n  };\n\n  request.onerror = error => reject(error);\n\n  request.onupgradeneeded = () => alreadyExists = false;\n});","import { dbExists } from './dbExists';\nexport const deleteDb = (name, succeedWhenNonExistant = false) => dbExists(name).then(exists => {\n  if (exists) {\n    return new Promise((resolve, reject) => {\n      const request = window.indexedDB.deleteDatabase(name);\n      request.onsuccess = resolve;\n      request.onerror = reject;\n    });\n  }\n\n  return succeedWhenNonExistant ? Promise.resolve() : Promise.reject();\n});","export const dhis2DatabaseNames = ['dhis2ou', 'dhis2', 'dhis2tc', 'dhis2ec', 'dhis2de', 'dhis2er', 'dhis2ca'];","import { dbExists } from './dbExists';\nimport { getKeyFromObjectStore } from './getKeyFromObjectStore';\nimport { openDb } from './openDb';\nconst userCachesStoreName = 'userCaches';\nexport const getCaptureAppUserDatabases = () => dbExists('dhis2ca').then(async captureDbExists => {\n  let db;\n  let dbNames = [];\n\n  if (captureDbExists) {\n    try {\n      db = await openDb('dhis2ca');\n      const data = await getKeyFromObjectStore(db, userCachesStoreName, 'accessHistory');\n\n      if (data && data.values) {\n        dbNames = data.values;\n      }\n    } catch (e) {\n      dbNames = [];\n    } finally {\n      db && db.close();\n    }\n  }\n\n  return dbNames;\n});","/**\n * @param {string} name\n * @returns {Promise.<IDBDatabase>}\n */\nexport const openDb = name => new Promise((resolve, reject) => {\n  const request = window.indexedDB.open(name);\n\n  request.onsuccess = () => resolve(request.result);\n\n  request.onerror = reject;\n});","export const getKeyFromObjectStore = (db, storeName, key) => new Promise((resolve, reject) => {\n  try {\n    const request = db.transaction(storeName).objectStore(storeName).get(key);\n\n    request.onsuccess = event => resolve(event.target.result);\n\n    request.onerror = reject;\n  } catch (e) {\n    reject(e);\n  }\n});","import { useEffect, useState } from 'react';\nimport { getCaptureAppUserDatabases } from './getCaptureAppUserDatabases';\nimport { getClearableDatabases } from './getClearableDatabases';\nexport const useClearableDatabaseKeys = () => {\n  const [refetchCounter, setRefetchCounter] = useState(0);\n\n  const refetch = () => setRefetchCounter(refetchCounter + 1);\n\n  const [loading, setLoading] = useState(true);\n  const [data, setData] = useState({\n    // Contains all databases that are listed in the\n    // \"dhis2DatabaseNames\" file that acutally exist\n    staticDatabases: [],\n    // these won't be listed, but should be deleted\n    // if the static database \"dhis2ca\" is deleted by the user\n    userDatabases: []\n  });\n  useEffect(() => {\n    const operation = async () => {\n      setLoading(true);\n      const staticDatabases = await getClearableDatabases().catch(() => []);\n      const userDatabases = await getCaptureAppUserDatabases().catch(() => []);\n      const allDatabases = {\n        staticDatabases,\n        userDatabases\n      };\n      setData(allDatabases);\n      setLoading(false);\n    };\n\n    operation();\n  }, [refetchCounter]);\n  return {\n    loading,\n    data,\n    refetch\n  };\n};","import { dbExists } from './dbExists';\nimport { dhis2DatabaseNames } from './dhis2DatabaseNames';\n/**\n * @returns {Promise.<String[]>}\n */\n\nexport const getClearableDatabases = () => Promise.all(dhis2DatabaseNames.map(name => dbExists(name).then(exists => exists ? name : null))).then(keys => {\n  const filtered = keys.filter(key => key);\n  return filtered;\n});","export const clearStoragesByKey = (storage, keys) => {\n  // remove keys\n  keys.forEach(key => storage.removeItem(key)); // return removal check\n\n  return keys.reduce((success, key) => {\n    // fail if already failed\n    if (!success) return false;\n    return storage.getItem(key) === null;\n  }, true);\n};","export const reservedStorageKeys = [// exclude methods and props of Storage instances\n...Object.keys(Storage.prototype), // custom dhis2 keys that should not be cleared\n'dhis2.menu.ui.headerBar.title', 'dhis2.menu.ui.headerBar.link', 'dhis2.menu.ui.headerBar.userStyle', 'DHIS2_BASE_URL'];","import { useCallback, useEffect, useState } from 'react';\nimport { getClearableKeys } from './getClearableKeys';\nexport const useClearableStorageKeys = storage => {\n  const [existingKeys, setExistingKeys] = useState([]);\n  const onStorageChange = useCallback(() => {\n    const existing = getClearableKeys(storage);\n    setExistingKeys(existing);\n  }, [storage]);\n  useEffect(() => {\n    onStorageChange();\n  }, [onStorageChange]);\n  return {\n    keys: existingKeys,\n    refetch: onStorageChange\n  };\n};","import { reservedStorageKeys } from './reservedStorageKeys';\n/**\n * @param {Storage} strage\n * @returns {String[]}\n */\n\nexport const getClearableKeys = storage => Object.keys(storage).filter(key => !reservedStorageKeys.includes(key));","import { clearDatabasesByKey } from '../../indexedDb';\nimport { clearStoragesByKey } from '../../storage';\n\nconst clearLocalStorageByKeys = keys => clearStoragesByKey(window.localStorage, keys);\n\nconst clearSessionStorageByKeys = keys => clearStoragesByKey(window.sessionStorage, keys);\n\nexport const deleteValues = async values => {\n  var _values$indexedDB;\n\n  if (values.localStorageKeys) {\n    clearLocalStorageByKeys(values.localStorageKeys);\n  }\n\n  if (values.sessionStorageKeys) {\n    clearSessionStorageByKeys(values.sessionStorageKeys);\n  }\n\n  if ((_values$indexedDB = values.indexedDB) === null || _values$indexedDB === void 0 ? void 0 : _values$indexedDB.length) {\n    await clearDatabasesByKey(values.indexedDB);\n  }\n};","import { deleteDb } from './deleteDb';\nexport const clearDatabasesByKey = keys => {\n  const allDeleteProcesses = keys.map(key => deleteDb(key, true));\n  return Promise.all(allDeleteProcesses);\n};","import i18n from '@dhis2/d2-i18n';\nimport React from 'react';\nimport { ClearForm } from '../clearForm';\nimport { useClearableDatabaseKeys } from '../indexedDb';\nimport { useClearableStorageKeys } from '../storage';\nimport styles from './Home.module.css';\nimport { deleteValues } from './Home/deleteValues';\nimport { formatDeleteValues } from './Home/formatDeleteValues';\nexport const Home = () => {\n  const {\n    keys: localStorageKeys,\n    refetch: refetchLocalStorageKeys\n  } = useClearableStorageKeys(window.localStorage);\n  const {\n    keys: sessionStorageKeys,\n    refetch: refetchSessionStorageKeys\n  } = useClearableStorageKeys(window.sessionStorage);\n  const {\n    loading,\n    error,\n    data: indexedDatabaseKeys,\n    refetch: refetchIndexedDatabaseKeys\n  } = useClearableDatabaseKeys();\n  const {\n    staticDatabases,\n    userDatabases\n  } = indexedDatabaseKeys;\n\n  const refetch = async () => {\n    refetchLocalStorageKeys();\n    refetchSessionStorageKeys();\n    await refetchIndexedDatabaseKeys();\n  };\n\n  const onSubmit = async values => {\n    const formattedValues = formatDeleteValues(values, userDatabases);\n    await deleteValues(formattedValues);\n    await refetch();\n  };\n\n  const showContent = !loading && !error;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container\n  }, loading && /*#__PURE__*/React.createElement(\"p\", {\n    \"data-test\": \"dhis2-cachecleaner-loading\"\n  }, i18n.t('Loading clearable data...')), error && i18n.t(`Something went wrong: ${error.message}`), showContent && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h1\", {\n    className: styles.headline,\n    \"data-test\": \"dhis2-cachecleaner-homeheadline\"\n  }, i18n.t('DHIS 2 browser cache cleaner')), /*#__PURE__*/React.createElement(ClearForm // keep these so the previously selected values\n  // are kept for rejection in the confirmation step\n  , {\n    localStorageKeys: localStorageKeys,\n    sessionStorageKeys: sessionStorageKeys,\n    indexedDatabaseKeys: staticDatabases,\n    onSubmit: onSubmit\n  })));\n};","export const formatDeleteValues = (values, userDatabases) => {\n  const {\n    indexedDatabaseKeys,\n    localStorageKeys,\n    sessionStorageKeys\n  } = values; // user databases should only be cleared when the \"dhis2ca\" db is cleared\n\n  const shouldDeleteUserDatabases = (indexedDatabaseKeys === null || indexedDatabaseKeys === void 0 ? void 0 : indexedDatabaseKeys.includes('dhis2ca')) && (userDatabases === null || userDatabases === void 0 ? void 0 : userDatabases.length);\n  return {\n    localStorageKeys: localStorageKeys || [],\n    sessionStorageKeys: sessionStorageKeys || [],\n    indexedDB: [...(indexedDatabaseKeys || []), ...(shouldDeleteUserDatabases ? userDatabases : [])]\n  };\n};","import { CssVariables } from '@dhis2/ui';\nimport React from 'react';\nimport './locales/index.js';\nimport { Home } from './views';\nexport default function App() {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\"\n  }, /*#__PURE__*/React.createElement(CssVariables, {\n    colors: true,\n    spacers: true\n  }), /*#__PURE__*/React.createElement(Home, null));\n}"],"sourceRoot":""}